{% extends "base.html" %}

{% block content %}
    <meta charset="UTF-8">

    <div style="position: absolute; top: 6.2%; left:25%; width: 50%;
    background-color: rgba(28, 28, 28, 0); font-size: large; color: white;">

        {% if list_problems != [] %}
        <div style="padding: 10px; background-color: rgb(28, 28, 28); font-size: large;"><form method="post">
            <button type="submit" class="btn btn{{ backlight[0] }}-secondary" name="options" value="0">По новизне</button>
            {% if not thank %}
            <button type="submit" class="btn btn{{ backlight[1] }}-secondary" name="options" value="1">По актуальности</button>
            <select class="form-select" aria-label="Default select example" style="position: absolute; left: 65%; top: 0.2%; width: 300px;" name="lst">
                <option selected value="0">Все регионы</option>
                {% for i in lst_regions %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
                </select>
            <script>
                const formSelect = document.querySelector('.form-select')
                const form = document.querySelector('form')
                // если форм несколько, то лучше добавить поиск элемента так: document.querySelector('.класс')
                // или document.querySelector('#id')

                formSelect.addEventListener('input', function(evt){
                    evt.preventDefault();

                    submitOption()
                })
                const onLoadSuccess = (data) => {
                    console.log('load', data);
                }
                const onLoadError = (data) => {
                    console.log('err', data);
                }
                const loadData = function(data, onSuccess, onError){
                fetch('http://localhost:{{ url }}/all_problems', {
                method: 'POST',
                body: data,
                 }).then(onSuccess).catch(onError)};

                const submitOption = function(){
                    const dataForm =  new FormData(form);
                    loadData(dataForm, onLoadSuccess, onLoadError);

                }
            </script>
        {% else %}
        <button type="submit" class="btn btn{{ backlight[1] }}-secondary" name="options" value="1">По популярности</button>
        {% endif %}</form></div>
            {% for i in list_problems %}
            <section>
                <article class="cell">
                    <div style="text-align: center;">
                        <h3>
                            <a>{{ i['name'] }}</a>
                        </h3>
                        {% if not thank %}
                        <div>
                            <div style="color: {{ i['color'] }}">{{ i['category'] }} проблема</div>
                        </div>
                        {% endif %}
                        <div>
                            <div>Опубликована: {{ i['date'] }}</div>
                        </div>
                        {% if not thank %}
                        <div>
                            <img src="../static/img/img_problems/{{ i['id'] }}.jpg" style="text-align: center;" height="50%" width="50%">
                        </div>
                        {% if i['ver'] == True %}
                            <div>
                            <img src="../static/img/verified.png" style="text-align: center;" height="50%" width="50%">
                        </div>
                        {% endif %}
                        <div>
                            <div style="text-align: left; padding: 10px 40px;">  {{ i['text'] }}</div>
                        </div>
                        {% if current_user.is_authenticated and not my_problems %}
                        <form method="post">
                           {% if i['pub'] == 0 %}
                            <button class="btn btn-outline-primary"  type="submit" name="prob_0" value="{{ i['id'] }}">Подтвердить</button></form>
                            {% elif i['pub'] == -1 %}
                            <button class="btn btn-primary"  type="submit" name="prob_1" value="{{ i['id'] }}">Подтвержена вами</button></form>
                            {% else %}
                            <button class="btn btn-danger"  type="submit" disabled>Опубликована</button></form>
                            {% endif %}
                        {% elif my_problems == True %}
                        <div style="text-align: center;">Количество подтверждений: {{ i['n_ver'] }}</div>
                        <button class="btn btn-info" type="button">Редактировать</button>
                        {% endif %}
                        {% else %}
                        <div>
                            <img src="../static/img/thanks/{{ i['id'] }}.jpg" style="text-align: center;" height="50%" width="50%">
                        </div>
                        <div>
                            <div style="text-align: left; padding: 10px 40px;">  {{ i['text'] }}</div>
                        </div>{% endif %}
                        {% if current_user.is_authenticated and not my_problems and thank %}
                        <form method="post">
                           {% if i['pub'] == 0 %}
                            <button class="btn btn-outline-primary"  type="submit" name="th_0" value="{{ i['id'] }}">Присоединиться</button></form>
                            {% elif i['pub'] == -1 %}
                            <button class="btn btn-primary"  type="submit" name="th_1" value="{{ i['id'] }}">Вы присоединились</button></form>
                            {% endif %}

                        {% endif %}
                    </div>
                </article>
            </section>
            {% endfor %}
        {% else %}
                    <div style="text-align: center; padding: 15px;">
                        <h3>
                            <a>Вы ещё не опубликовали ни одной проблемы</a>
                        </h3>
                    </div>
        {% endif %}
        </div>
{% endblock %}