{% extends "base.html" %}

{% block content %}
    <meta charset="UTF-8">
    <div style="position: absolute; top: 6.2%; left:25%; width: 50%;
    background-color: rgba(28, 28, 28, 0); font-size: large; color: white;">

        {% if list_problems != [] %}
        <div style="padding: 10px; background-color: rgb(28, 28, 28); font-size: large;">
            <form method="post">
                <button type="submit" class="btn btn{{ backlight[0] }}-secondary" name="options" value="0">По новизне</button>
                {% if not thank %}
                <button type="submit" class="btn btn{{ backlight[1] }}-secondary" name="options" value="1">По актуальности</button>
                <select class="form-select" aria-label="Default select example" style="position: absolute; left: 65%; top: 2%; width: 300px;" name="lst">
            <option selected value="0">Все регионы</option>
            {% for i in lst_regions %}
            <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
        </select><script>
               const formSelect = document.querySelector('.form-select')
               const form = document.querySelector('form')
               // если форм несколько, то лучше добавить поиск элемента так: document.querySelector('.класс')
               // или document.querySelector('#id')
               formSelect.addEventListener('input', function(evt){
                   evt.preventDefault();
                   submitOption()
               })
               const onLoadSuccess = (data) => {
                   console.log('load', data);
               }
               const onLoadError = (data) => {
                   console.log('err', data);
               }
               const loadData = function(data, onSuccess, onError){
               fetch('http://localhost:{{ url }}/all_problems', {
               method: 'POST',
               body: data,
                }).then(onSuccess).catch(onError)};
               const submitOption = function(){
                   const dataForm =  new FormData(form);
                   loadData(dataForm, onLoadSuccess, onLoadError);
               }
            </script>
        {% else %}
        <button type="submit" class="btn btn{{ backlight[1] }}-secondary" name="options" value="1">По популярности</button>
        {% endif %}</form></div>
            {% for i in list_problems %}
            <section>
                <article class="cell">
                    <div style="text-align: center;">
                        <h3>
                            <a>{{ i['name'] }}</a>
                        </h3>
                        <div>
                            <div style="color: {{ i['color'] }}">{{ i['category'] }} проблема</div>
                        </div>
                        <div>
                            <div>Опубликована: {{ i['date'] }}</div>
                        </div>
                        <div>
                            <img src="../static/img/resolved_problems/{{ i['id'] }}.jpg" style="text-align: center;" height="50%" width="50%">
                        </div>
                        <div>
                            <div style="text-align: left; padding: 10px 40px;">  {{ i['text'] }}</div>
                        </div>
                        {% if  not i['rating'] %}
                        <h4>Данные об рейтинге отсутствуют</h4>
                        {% else %}
                        <h4 style="padding: 0px;">Рейтинг</nobr></h4>
                        <link rel="stylesheet" type="text/css" href="../static/css/star.css"/>
                        <div class="rating-result">
                            {% for j in range(i['rating']) %}
                        	    <span class="active"></span>
                            {% endfor %}
                            {% for j in range(5 - i['rating']) %}
                        	    <span></span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        <form method="post" style="margin: 10px 0px;">
                        {% if i['pub'] == 1 %}
                        <link rel="stylesheet" type="text/css" href="../static/css/star.css"/>
                        <div class="rating-result">
                            <h4 style="padding: 0px;"><nobr>Ваша оценка</nobr></h4>
                            {% for j in range(i['my_rating']) %}
                        	    <span class="active"></span>
                            {% endfor %}
                            {% for j in range(5 - i['my_rating']) %}
                        	    <span></span>
                            {% endfor %}
                        </div>
                        {% elif current_user.is_authenticated %}
                            <form action="">
                            <select class="form-select" aria-label="Default select example" name="rating" style="width: 70px; position: absolute; top: 47%; left: 35%;">
                                <option selected value="1">1</option>
                                <option selected value="2">2</option>
                                <option selected value="3">3</option>
                                <option selected value="4">4</option>
                                <option selected value="5">5</option>
                            </select><button class="btn btn-outline-danger"  type="submit" name="problem" value="{{ i['id'] }}">Оценить</button>
                            </form>

                        {% endif %}
                            <form method="post"><button class="btn btn-outline-primary" name="href" value="{{ i['id'] }}" type="submit">Перейти к проблеме</button></form>
                    </form></div>
                </article>
            </section>
            {% endfor %}
        {% else %}
                    <div style="text-align: center; padding: 15px;">
                        <h3>
                            <a>По данному запросу нет решённых проблем</a>
                        </h3>
                    </div>
        {% endif %}
        </div>
{% endblock %}